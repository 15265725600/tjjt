<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>必普送</title>
		<link rel="stylesheet" href="../assets/css/amazeui.css" />
		<link rel="stylesheet" href="../assets/css/common.css" />
		<link rel="stylesheet" href="../assets/css/order-details.css" />
	</head>

	<body>
		<!--header部分-->
		<header data-am-widget="header" class="am-header header-white">
			<div class="am-header-left am-header-nav">
				<a href="javascript:history.back()" class="">
					<i class="_back"></i>
				</a>
			</div>
			<h1 class="am-header-title">
	        详情
	      </h1>

		</header>
		<div class="container" style="margin-bottom: 69px;">
			<script type="text/html" id="ship_div">
				<div class="po-address clearfix">
					<p>
						<span>{{infor[0].recipient_name}}</span> <em>{{infor[0].recipient_mobile}}</em></br>
						{{infor[0].recipient_address}}
					</p>

				</div>
				<div class="po-time">
					<div class="p-t-top">配送时间 <span class="gray">不限时间</span></div>

				</div>
				<div class="hui"></div>
				<!--商品信息-->
				<div class="po-info">
					<div class="shop_detail"></div>
					{{each infor[0].goods_list as item index}}
					<div class="po-i-pic border-b clearfix">
						<div class="i-p-left am-fl"><img src="{{item.goods_img}}" alt="" /></div>
						<div class="i-p-right clearfix">
							<p>{{item.goods_name}}</p>
							<span>￥<i class = "Unit-Price">{{item.price}}</i><em class = "gray quantity">x<b class = "Num">{{item.count}}</b></em></span> {{ if infor[0].status == 4 && infor[0].goods_list[0].if_evaluate == 0}}
							<a href="javascript:location.href = preUrl('my/evaluate.html?orderID={{item.order_id}}&goods_id={{item.goods_id}}&id={{item.id}}')" class="apply-eva">去评价</a>
							{{/if}}
						</div>

					</div>

					{{/each}}
					<div class="po-i-total clearfix border-b">
						<sapn>商品总额</sapn>
						<span class="am-fr">￥<i class = "total">{{infor[0].totalprice}}</i></span>
					</div>
					<div class="po-i-discount clearfix border-b">
						<a href="Coupon.html" style="display: block;">优惠券<i class="am-fr">－￥<em class = "discount">{{infor[0].coupon_price}}</em></i></a>
					</div>
					<div class="po-i-price clearfix">
						<span class="am-fr gray">实付款:<i class = "Actual-payment"><em class = "actual-price orange">￥{{infor[0].paid_price}}</em></i></span><span class="am-fr black op" style="margin-right:10px;text-decoration: line-through">原价：<i class = "Oprice orange" style = "font-size:16px;">￥{{infor[0].original_price}}</i></span>
					</div>
					<div class="hui"></div>

				</div>
				<!--备注-->
				<div class="po-remarks">
					<h4 class="black">备注</h4>
					<p class="gray">{{infor[0].remark}}</p>
				</div>
				{{if infor[0].status == 1}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单状态:<span>待付款</span></p>
				</div>
				{{else if infor[0].status == 2}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单状态:<span>待发货</span></p>
				</div>
				{{else if infor[0].status == 3}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单号:<span>{{infor[0].order_no}}</span></p>
					{{if infor[0].delivery_type == 0}}
					<p>司机名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>司机电话:<span>{{infor[0].delivery_no}}</span></p>
					{{else if infor[0].delivery_type == 1}}
					<p>快递名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>快递单号:<a href="https://m.kuaidi100.com/index_all.html?&postid={{infor[0].delivery_no}}"><span>{{infor[0].delivery_no}}</span></a></p>
					{{/if}}
					<p>订单状态:<span>待收货</span></p>
				</div>
				{{else if infor[0].status == 4}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单号:<span>{{infor[0].order_no}}</span></p>
					{{if infor[0].delivery_type == 0}}
					<p>司机名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>司机电话:<span>{{infor[0].delivery_no}}</span></p>
					{{else if infor[0].delivery_type == 1}}
					<p>快递名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>快递单号:<a href="https://m.kuaidi100.com/index_all.html?&postid={{infor[0].delivery_no}}"><span>{{infor[0].delivery_no}}</span></a></p>
					{{/if}}
					<p>订单状态:<span>待评价</span></p>
				</div>
				{{else if infor[0].status == 5}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单号:<span>{{infor[0].order_no}}</span></p>
					{{if infor[0].delivery_type == 0}}
					<p>司机名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>司机电话:<span>{{infor[0].delivery_no}}</span></p>
					{{else if infor[0].delivery_type == 1}}
					<p>快递名称:<span>{{infor[0].delivery_name}}</span></p>
					<p>快递单号:<a href="https://m.kuaidi100.com/index_all.html?&postid={{infor[0].delivery_no}}"><span>{{infor[0].delivery_no}}</span></a></p>
					{{/if}}
					<p>订单状态:<span>已完成</span></p>
				</div>
				{{else if infor[0].status == 6}}
				<div class="po-status">
					<p>下单时间:<span>{{infor[0].createtime}}</span></p>
					<p>付款时间:<span>{{infor[0].pay_time}}</span></p>
					<p>订单号:<span>{{infor[0].order_no}}</span></p>
					<p>订单状态:<span>已关闭</span></p>
				</div>
				{{/if}} {{if infor[0].status == 1}}
				<footer class="np-footer clearfix">
					<a href="javascript:location.href=preUrl('index/pay.html?orderID={{infor[0].id}}&price={{infor[0].paid_price}}')" class="np-pay am-fr">去支付</a>
					<a href="javascript:;" class="np-del am-fr">取消订单</a>
				</footer>

				{{else if infor[0].status == 5}}
				<footer class="np-footer clearfix">
					<a href="javascript:;" class="del-order am-fr">删除订单</a>
				</footer>
				{{else if infor[0].status == 6}}
				<footer class="np-footer clearfix">
					<a href="javascript:;" class="del-order am-fr">删除订单</a>
				</footer>
				{{else if infor[0].status == 3}}
				<footer class="np-footer clearfix">
					<span class="am-fl gray">7天默认收货</span>
					<a href="javascript:;" class="confirm-pay am-fr">确认收货</a>
					<a href="javascript:;" class="follow-logistics am-fr">追踪物流</a>
				</footer>
				{{else if infor[0].status == 2}}
				<footer class="np-footer clearfix">
					<a href="javascript:location.href = preUrl('my/after-sales.html?orderID={{infor[0].id}}&price={{infor[0].paid_price}}')" class="apply-sale am-fr">申请售后</a>
				</footer>

				{{/if}}
			</script>

		</div>
	</body>
	<script src="../assets/js/jquery.min.js"></script>
	<script src="../assets/js/amazeui.js"></script>
	<script src="../assets/js/template.js"></script>
	<script src="../assets/js/common.js"></script>
	<script src="../assets/js/md5.js"></script>

	<script>
		var orderID = GetQueryString('orderID');
		var token = getCookie('token');
		var discount = getCookie('discount');
		$.ajax({
			type: 'POST',
			url: reqUrl("order_get"),
			data: {
				order_id: orderID,
				token: token

			},
			dataType: 'JSON',
			async: false,
			xhrFields: {
				withCredentials: true
			},
			success: function(data) {
				if(data.error_data == 200) {
					window.location.href = preUrl('log/login.html?path=my/shipment-details.html')
				}
				if(data.success) {
					var shipDiv = template('ship_div', data);
					$('.container').html(shipDiv);
					if(discount <= 0.0) {
						$('.op').hide();
					}
				}
			},
			error: function(e, request, settings) {
				alert(settings);
			}
		});
		//取消订单
		var para = window.location.search;
		$('.container').on('click', function(e) {
			var cls = e.target.className;
			if(cls == 'del-order am-fr') {
				$.ajax({
					type: 'POST',
					url: reqUrl('order_oper'),
					data: {
						token: token,
						order_id: orderID,
						operatetype: 3
					},
					xhrFields: {
						withCredentials: true
					},
					dataType: 'json',
					success: function(data) {
						if(data.error_code == 200) {
							window.location.href = preUrl('log/login.html' + para + '&path=my/shipment-details.html');
						} else if(data.success) {
							console.log(data.msg);
							mask('删除成功');
							setTimeout(function() {
								location.href = document.referrer;
							}, 1000);
						} else {
							mask(data.msg);
						}
					}
				});
			} else if(cls == 'np-del am-fr') {
				$.ajax({
					type: 'POST',
					url: reqUrl('order_oper'),
					data: {
						token: token,
						order_id: orderID,
						operatetype: 2
					},
					xhrFields: {
						withCredentials: true
					},
					dataType: 'json',
					success: function(data) {
						if(data.error_code == 200) {
							window.location.href = preUrl('log/login.html' + para + '&path=my/shipment-details.html.html');
						} else if(data.success) {
							console.log(data.msg);
							mask('删除成功');
							setTimeout(function() {
								location.reload();
							}, 1000);
						} else {
							mask(data.msg);
						}
					}
				});
			} else if(cls == 'confirm-order am-fr') {
				$.ajax({
					type: 'POST',
					url: reqUrl('order_oper'),
					data: {
						token: token,
						order_id: orderID,
						operatetype: 1
					},
					xhrFields: {
						withCredentials: true
					},
					dataType: 'json',
					success: function(data) {
						if(data.error_code == 200) {
							window.location.href = preUrl('log/login.html' + para + '&path=my/shipment-details.html');
						} else if(data.success) {
							console.log(data.msg);
							mask('删除成功');
							setTimeout(function() {
								location.reload();
							}, 1000);
						} else {
							mask(data.msg);
						}
					}
				});
			}
		});
	</script>

</html>